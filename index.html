<!DOCTYPE html>
<html lang="tr">

<head>
  <link rel="stylesheet" href="ekran.css">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bidentist | Randevu Sistemi</title>
  <meta name="description" content="Dis klinigi randevu ekrani" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400&display=swap"
    rel="stylesheet">
  <style>
    #next,
    #calendarStep {
      scroll-margin-top: var(--header-h);
      /* extra 12px removed */
    }


    :root {
      /* palette */
      --navy: #0A2342;
      --blue: #1E6FB6;
      --gold: #B68B2A;
      --bg: #A5A5A5;
      --card: #ffffff;
      --text: #0b1118;
      --muted: #A5A5A5;
      --radius: 16px;
      --danger: #d62828;
      --overlay: rgba(0, 0, 0, .5);
      --header-h: 80px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: 'Open Sans', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, #e7f1ff 0%, rgba(231, 241, 255, 0) 60%),
        radial-gradient(900px 700px at 110% 10%, #dfeaff 0%, rgba(231, 241, 255, 0) 55%),
        var(--bg);
      overflow-x: hidden;
    }

    /* background teeth */
    .bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }

    .tooth {
      position: absolute;
      width: 48px;
      height: 48px;
      opacity: .10;
      animation: fall 18s linear infinite;
      will-change: transform, opacity;
      filter: drop-shadow(0 0 6px rgba(30, 144, 255, .22));
      color: var(--blue);
    }

    .sm {
      width: 28px;
      height: 28px;
      animation-duration: 20s;
      opacity: .14
    }

    .lg {
      width: 68px;
      height: 68px;
      animation-duration: 24s;
      opacity: .08
    }

    @keyframes fall {
      from {
        transform: translate3d(var(--x, 0vw), -20vh, 0) rotate(0turn);
      }

      to {
        transform: translate3d(var(--x, 0vw), 110vh, 0) rotate(1turn);
      }
    }

    /* header */
    header {
      header {
        height: var(--header-h);
        z-index: 999;
      }

      height: var(--header-h);
      z-index: 999;
      /* icerikten ustte kalsin */
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 22px;
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(10, 35, 66, .97), rgba(10, 35, 66, .86));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255, 255, 255, .08);
      color: #fff;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .logo {
      width: 275px;
      height: 65px;
      object-fit: cover;
      border-radius: 12px;
      background: rgba(10, 37, 64, .97);
      border: 1px solid rgba(0, 0, 0, .08);
    }

    .brand-name {
      font-weight: 700;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      appearance: none;
      border: 0;
      cursor: pointer;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700;
      color: #0a2540;
      background: var(--gold);
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
      box-shadow: 0 10px 30px rgba(182, 139, 42, .25), inset 0 0 0 1px rgba(0, 0, 0, .06);
    }

    .btn:hover {
      transform: translateY(-1px)
    }

    .btn:disabled {
      opacity: .55;
      cursor: not-allowed
    }

    /* hero */
    .hero {
      max-width: 1100px;
      margin: 8vh auto 0;
      padding: 0 22px;
      text-align: center;
    }

    /* headings use Montserrat Bold */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    .title,
    .modal h3 {
      font-family: 'Montserrat', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 700;
    }

    h1 {
      margin: 18px 0 10px;
      line-height: 1.08;
      font-size: clamp(28px, 6vw, 52px);
      letter-spacing: .2px;
      color: var(--navy);
    }

    .lead {
      margin: 8px auto 22px;
      max-width: 760px;
      font-size: clamp(15px, 2.2vw, 18px);
      color: var(--muted);
    }

    /* card */
    .card {
      margin: 28px auto 40px;
      max-width: 900px;
      padding: 22px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .97), rgba(255, 255, 255, .90));
      border: 1px solid rgba(0, 0, 0, .06);
      border-radius: var(--radius);
      box-shadow: 0 20px 60px rgba(0, 0, 0, .10);
    }

    /* vertical form */
    .form-vertical {
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: stretch;
      max-width: 560px;
      margin: 0 auto;
    }

    .field {
      display: flex;
      flex-direction: column;
      text-align: left;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: var(--navy);
    }

    .req {
      color: var(--danger);
      margin-left: 6px;
    }

    select,
    input[type="text"],
    input[type="tel"],
    input[type="email"] {
      padding: 14px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, .12);
      background: #fff;
      font-size: 16px;
      outline: none;
    }

    .helper {
      color: var(--danger);
      font-size: 12px;
      min-height: 16px;
      margin-top: 6px;
    }

    /* date wheel */
    .date-wheel {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
      padding: 12px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .12);
      font-size: 18px;
    }

    .date-wheel select {
      appearance: none;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, .08);
      background: #fff;
      font-size: 16px;
      text-align: center;
    }

    /* calendar */
    #calendarStep .title {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 12px;
      color: var(--navy);
    }

    .cal {
      max-width: 760px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .12);
      border-radius: 16px;
      padding: 16px;
    }

    .cal-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .cal-head .month {
      font-weight: 700;
      font-size: 18px;
      color: var(--navy);
    }

    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .dow {
      text-align: center;
      font-weight: 600;
      color: #4b5563;
      padding: 8px 0;
    }

    .day {
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, .08);
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      background: #f7fbff;
      will-change: transform;
    }

    .day:hover {
      outline: 2px solid rgba(30, 144, 255, .35);
    }

    .day.disabled {
      opacity: .35;
      cursor: not-allowed;
      text-decoration: line-through;
      background: #f1f5f9;
    }

    .day.selected {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }

    .slots {
      margin-top: 18px;
    }

    .slots h3 {
      margin: 0 0 10px;
      font-size: 18px;
      color: var(--navy);
    }

    .slot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 10px;
    }

    .slot {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, .12);
      background: #fff;
      cursor: pointer;
      font-weight: 700;
      text-align: center;
      color: var(--navy);
      will-change: transform;
    }

    .slot[disabled] {
      opacity: .4;
      cursor: not-allowed;
      text-decoration: line-through;
    }

    .slot.selected {
      background: var(--navy);
      color: #fff;
      border-color: var(--navy);
    }

    /* modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: var(--overlay);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
    }

    .modal {
      background: #fff;
      border-radius: 16px;
      max-width: 680px;
      width: 100%;
      border: 1px solid rgba(0, 0, 0, .08);
      box-shadow: 0 20px 60px rgba(0, 0, 0, .25);
      padding: 18px;
    }

    /* dark theme modal readability */
    html[data-theme="dark"] .modal {
      background: var(--card);
      color: var(--text);
      border-color: rgba(255, 255, 255, .12);
    }

    .modal h3 {
      margin: 0 0 10px;
      font-size: 20px;
      color: var(--navy);
    }

    html[data-theme="dark"] .modal h3 {
      color: var(--text);
    }

    .summary-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 8px;
    }

    .summary-list li {
      display: flex;
      gap: 8px;
    }

    .summary-key {
      min-width: 160px;
      font-weight: 600;
      color: #374151;
    }

    html[data-theme="dark"] .summary-key {
      color: var(--text);
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 14px;
    }

    /* accessibility helper to hide labels visually but keep for screen readers */
    .vh {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    /* theme switch (pill + knob) */
    .theme-switch {
      width: 56px;
      height: 30px;
      padding: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      border: 1px solid rgba(0, 0, 0, .12);
      display: flex;
      align-items: center;
      cursor: pointer;
      position: relative;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.2);
      /* ensure icons are visible */
      overflow: hidden;
    }

    .theme-switch .icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      opacity: .8;
      pointer-events: none;
    }

    .theme-switch .sun {
      left: 8px;
    }

    .theme-switch .moon {
      right: 8px;
    }

    /* clarify state: in light, sun prominent; in dark, moon prominent */
    html:not([data-theme="dark"]) .theme-switch .sun {
      opacity: 1;
    }

    html:not([data-theme="dark"]) .theme-switch .moon {
      opacity: .4;
    }

    .theme-switch .switch-handle {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, .25), inset 0 0 0 1px rgba(0, 0, 0, .06);
      transform: translateX(0);
      transition: transform .25s ease;
    }

    html[data-theme="dark"] .theme-switch {
      background: #111827;
      border-color: rgba(255, 255, 255, .2);
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, .3);
    }

    html[data-theme="dark"] .theme-switch .switch-handle {
      transform: translateX(26px);
      background: var(--gold);
    }

    html[data-theme="dark"] .theme-switch .sun {
      opacity: .4;
    }

    html[data-theme="dark"] .theme-switch .moon {
      opacity: 1;
    }

    /* icon colors for readability */
    .theme-switch .icon {
      color: #0a2540;
    }

    html[data-theme="dark"] .theme-switch .icon {
      color: #e5e7eb;
    }

    /* dark theme overrides */
    html[data-theme="dark"] {
      --bg: #0b1118;
      --card: #0f172a;
      --text: #e5e7eb;
      --muted: #A5A5A5;
    }

    html[data-theme="dark"] body {
      background: linear-gradient(180deg, #0b1118, #0a0f1a);
      color: var(--text);
    }

    html[data-theme="dark"] .card {
      background: var(--card) !important;
      border-color: rgba(255, 255, 255, .08);
      color: var(--text);
    }

    /* improve inputs readability in dark */
    html[data-theme="dark"] select,
    html[data-theme="dark"] input[type="text"],
    html[data-theme="dark"] input[type="tel"],
    html[data-theme="dark"] input[type="email"] {
      background: #0b1220;
      color: #e5e7eb;
      border-color: rgba(255, 255, 255, .15);
    }

    html[data-theme="dark"] label {
      color: #e5e7eb;
    }

    html[data-theme="dark"] .helper {
      color: #fca5a5;
    }

    html[data-theme="dark"] .date-wheel {
      background: #0b1220;
      border-color: rgba(255, 255, 255, .12);
    }

    html[data-theme="dark"] .cal {
      background: #0b1220;
    }

    html[data-theme="dark"] .day {
      background: #0e1628;
      color: #e5e7eb;
      border-color: rgba(255, 255, 255, .08);
    }

    html[data-theme="dark"] .day.disabled {
      background: #0a0f1a;
    }

    html[data-theme="dark"] .slots h3 {
      color: #e5e7eb;
    }

    html[data-theme="dark"] .slot {
      background: #0e1628;
      color: #e5e7eb;
      border-color: rgba(255, 255, 255, .1);
    }

    html[data-theme="dark"] .cal {
      background: var(--card);
      border-color: rgba(255, 255, 255, .08);
    }

    html[data-theme="dark"] h1 {
      background: none !important;
      -webkit-text-fill-color: inherit !important;
      color: var(--text) !important;
      text-shadow: none;
    }

    /* Floating contact widget */
    .contact-widget {
      position: fixed;
      right: 22px;
      bottom: 22px;
      z-index: 1200;
    }

    .contact-fab {
      width: 50px;
      height: 50px;
      border-radius: 22px;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .25), inset 0 1px 0 rgba(255, 255, 255, .25);
      border: 1px solid rgba(0, 0, 0, .08);
      background:
        radial-gradient(circle at 35% 38%, #fff 0 48%, transparent 49%),
        radial-gradient(circle at 60% 30%, #fff 0 46%, transparent 47%),
        radial-gradient(circle at 50% 60%, #fff 0 52%, transparent 53%),
        radial-gradient(circle at 40% 70%, #fff 0 50%, transparent 51%),
        linear-gradient(#ffffff, #ffffff);
    }

    html[data-theme="dark"] .contact-fab {
      border-color: rgba(255, 255, 255, .12);
    }

    .contact-fab .phone-icon {
      font-size: 30px;
      line-height: 1;
      color: #22c55e;
      /* green */
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, .25));
    }

    /* phone badge on the FAB, visible in both themes */
    /* same color works well on dark too */

    .bubbles {
      position: absolute;
      right: 0;
      bottom: 78px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
    }

    .bubble {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: #ffffff;
      color: #0a2540;
      border: 1px solid rgba(0, 0, 0, .08);
      box-shadow: 0 10px 24px rgba(0, 0, 0, .18);
      text-decoration: none;
      font-weight: 600;
      opacity: 0;
      transform: translateY(10px) scale(.96);
      pointer-events: none;
      transition: opacity .20s ease, transform .20s ease;
    }

    .bubble .icon {
      font-size: 16px;
    }

    .contact-widget:hover .bubble,
    .contact-widget:focus-within .bubble {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .bubble:nth-child(1) {
      transition-delay: .02s;
    }

    .bubble:nth-child(2) {
      transition-delay: .07s;
    }

    .bubble:nth-child(3) {
      transition-delay: .12s;
    }

    .bubble:nth-child(4) {
      transition-delay: .17s;
    }

    html[data-theme="dark"] .bubble {
      background: #0f172a;
      color: var(--text);
      border-color: rgba(255, 255, 255, .06);
    }

    /* speed up the personal info step: reduce animations/transitions */
    #next .card,
    #next .field,
    #next select,
    #next input {
      animation: none !important;
      transition: none !important;
    }
  </style>
</head>

<body>
  <!-- background teeth -->

  <!-- header -->
  <header>
    <div class="brand">
      <img class="logo" id="siteLogo" src="bidentistlogo.png" alt="Klinik logosu" />

    </div>
    <nav class="actions" aria-label="Hizli Islemler">
      <div class="theme-switch" id="themeToggle">
        <span class="icon sun">☀️</span>
        <span class="icon moon">🌙</span>
        <div class="switch-handle"></div>
      </div>

    </nav>
  </header>

  <!-- main -->
  <main>
    <section class="hero">
      <h1>Kolay Randevu, Sağlıklı Gülüş</h1>

      <div class="card" role="region" aria-label="Randevu Formu">
        <!-- STEP 1: location -> clinic -> procedure -->
        <form id="preForm" class="form-vertical" novalidate>
          <div class="field">
            <label for="city" class="vh">📍 İl<span class="req">*</span></label>
            <select id="city" required>
              <option value="">📍 Şehir seçiniz</option>
            </select>
            <div class="helper" id="cityHelp"></div>
          </div>

          <div class="field">
            <label for="district" class="vh">🏙️ İlçe<span class="req">*</span></label>
            <select id="district" required disabled>
              <option value="">🏙️ İlçe seçiniz</option>
            </select>
            <div class="helper" id="districtHelp"></div>
          </div>

          <div class="field">
            <label for="clinic" class="vh">🏥 Klinik Seçimi<span class="req">*</span></label>
            <select id="clinic" required disabled>
              <option value="">🏥 Klinik seçiniz</option>
            </select>
            <div class="helper" id="clinicHelp"></div>
          </div>

          <div class="field">
            <label for="proc" class="vh">🧾 İşlem Tipi<span class="req">*</span></label>
            <select id="proc" required>
              <option value="">🧾 İşlem tipi seçiniz</option>
              <option>Genel Muayene</option>
              <option>Dis Tasi Temizligi</option>
              <option>Dis Beyazlatma</option>
              <option>Dis Cekimi</option>
              <option>Dis Dolguleri</option>
              <option>Implant</option>
              <option>Kanal Tedavisi</option>
              <option>Ortodonti</option>
              <option>Kaplama</option>
            </select>
            <div class="helper" id="procHelp"></div>
          </div>

          <button type="submit" class="btn" id="nextBtn">Ileri</button>
        </form>
      </div>
    </section>

    <!-- STEP 2: personal info -->
    <section id="next" hidden>
      <div class="card">
        <form id="infoForm" class="form-vertical" novalidate>
          <!-- single ID field -->
          <div class="field" id="idField">
            <label for="idInput" id="idLabel" class="vh">🪪 T.C. Kimlik Numarası <span class="req">*</span></label>
            <input type="text" id="idInput" maxlength="11" inputmode="numeric" placeholder="🪪 11 haneli TCKN">
            <div class="helper" id="idHelp"></div>
          </div>

          <!-- checkbox under the field -->
          <div class="field" style="display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="nonCitizen" />
            <label for="nonCitizen" style="font-weight:600;">TC vatandaşı değilim</label>
          </div>

          <div class="field">
            <label for="fullname" class="vh">👤 Ad Soyad<span class="req">*</span></label>
            <input type="text" id="fullname" placeholder="👤 Ad Soyad">
            <div class="helper" id="fullnameHelp"></div>
          </div>

          <div class="field">
            <label class="vh">🎂 Doğum Tarihi<span class="req">*</span></label>
            <div class="date-wheel">
              <select id="dobDay"></select>
              <select id="dobMonth"></select>
              <select id="dobYear"></select>
            </div>
            <div class="helper" id="dobHelp"></div>
          </div>

          <div class="field">
            <label for="phone" class="vh">📞 Telefon (5xx)xxx-xx-xx</label>
            <input type="tel" id="phone" placeholder="📞 (5__)___-__-__" inputmode="numeric" maxlength="16">
            <div class="helper" id="phoneHelp"></div>
          </div>

          <div class="field">
            <label for="email" class="vh">📧 E-posta</label>
            <input type="email" id="email" placeholder="📧 ornek@mail.com">
            <div class="helper" id="emailHelp"></div>
          </div>

          <button type="submit" class="btn" id="finishBtn">Devam Et</button>
        </form>
      </div>
    </section>

    <!-- STEP 3: calendar & slots -->
    <section id="calendarStep" hidden>
      <div class="card">
        <div class="title">Randevu Takvimi</div>
        <div class="cal" id="calendar">
          <div class="cal-head">
            <button class="btn" type="button" id="prevMonth">&#9664;</button>
            <div class="month" id="monthLabel">Ay Yil</div>
            <button class="btn" type="button" id="nextMonth">&#9654;</button>
          </div>
          <div class="cal-grid" id="dow">
            <div class="dow">Pzt</div>
            <div class="dow">Sal</div>
            <div class="dow">Çar</div>
            <div class="dow">Per</div>
            <div class="dow">Cum</div>
            <div class="dow">Cmt</div>
            <div class="dow">Paz</div>
          </div>
          <div class="cal-grid" id="days"></div>
        </div>

        <div class="slots" id="slotsWrap" hidden>
          <h3>Randevu Saati</h3>
          <div class="slot-grid" id="slotGrid"></div>
          <div style="margin-top:12px; display:flex; justify-content:flex-end;">
            <button type="button" class="btn" id="completeBtn" disabled>Randevuyu Tamamla</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- SUMMARY MODAL -->
  <div class="modal-backdrop" id="summaryBackdrop" role="dialog" aria-modal="true" aria-labelledby="summaryTitle">
    <div class="modal">
      <h3 id="summaryTitle">🗒️ Randevu Özeti</h3>
      <ul class="summary-list" id="summaryList"></ul>
      <div class="modal-actions">
        <button type="button" class="btn" id="saveSummary">Kaydet</button>
        <button type="button" class="btn" id="closeSummary">Kapat</button>
      </div>
    </div>
  </div>



  <!-- CONFIRM MODAL -->
  <div class="modal-backdrop" id="confirmBackdrop" role="dialog" aria-modal="true" aria-labelledby="confirmTitle"
    style="display:none;">
    <div class="modal">
      <h3 id="confirmTitle">Onay</h3>
      <p id="confirmMessage" style="margin:8px 0 0; color:var(--navy);"></p>
      <div class="modal-actions">
        <button type="button" class="btn" id="confirmNo">Hayir</button>
        <button type="button" class="btn" id="confirmYes">Evet</button>
      </div>
    </div>
  </div>

  <!-- INFO MODAL -->
  <div class="modal-backdrop" id="infoBackdrop" role="dialog" aria-modal="true" aria-labelledby="infoTitle"
    style="display:none;">
    <div class="modal">
      <h3 id="infoTitle">Bilgi</h3>
      <p id="infoMessage" style="margin:8px 0 0; color:var(--navy);"></p>
      <div class="modal-actions">
        <button type="button" class="btn" id="infoClose">Kapat</button>
      </div>
    </div>
  </div>

  <script>

    // start-of-script: keep page top on first load (no auto restore)
    try {
      if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
    } catch (_) { }
    window.addEventListener('load', () => {
      window.scrollTo({ top: 0, left: 0, behavior: 'auto' });
    });

    // Dark Mode Toggle
    (function initDarkMode() {
      const toggle = document.getElementById('themeToggle');
      const html = document.documentElement;

      const savedTheme = localStorage.getItem('theme') || 'light';
      html.setAttribute('data-theme', savedTheme);

      toggle.addEventListener('click', () => {
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);


        html.style.transition = 'all 0.3s ease';
        setTimeout(() => html.style.transition = '', 300);
      });

      // use CSS-only knob; keep ARIA title for accessibility
      toggle.setAttribute('role', 'switch');
      toggle.setAttribute('aria-checked', savedTheme === 'dark');
      toggle.title = savedTheme === 'dark' ? 'Light Mode' : 'Dark Mode';

      toggle.addEventListener('click', () => {
        const isDark = html.getAttribute('data-theme') === 'dark';
        toggle.setAttribute('aria-checked', (!isDark).toString());
        toggle.title = !isDark ? 'Light Mode' : 'Dark Mode';
      });

      // set initial ARIA title on icons as well
      const sun = toggle.querySelector('.sun');
      const moon = toggle.querySelector('.moon');
      if (sun) sun.setAttribute('aria-hidden', 'true');
      if (moon) moon.setAttribute('aria-hidden', 'true');
    })();

    // sample clinic directory (update addresses as needed)
    const clinicDirectory = {
      "Istanbul": {
        "Eyupsultan": [
          {
            name: "Dt. Enes Gunduz",
            address: "Güzeltepe, Mareşal Fevzi Çakmak Cd. No:106, 34060 Eyüpsultan/İstanbul",
            mapLink: "https://maps.app.goo.gl/2zPgLi2Yt4cJyho79"
          }
        ],
        "Bayrampasa": [
          {
            name: "Koklu Agiz Ve Dis Sagligi",
            address: "Yıldırım, 100. Yil Cd no.19-21B, 34035 , Bayrampaşa/İstanbul",
            mapLink: "https://maps.app.goo.gl/L68KPfBEA4xJLjhZ7"
          }
        ]
      },
      "Gaziantep": {
        "Osmangazi": [
          {
            name: "Doctor Kudeyt",
            address: "Osmangazi, Hayrettin Karaca Sk No:6, 27560 Şehitkamil / Gaziantep",
            mapLink: "https://www.google.com/maps?q=37.065806,37.331361"
          }
        ]
      }
    };

    // Step 1: cascading selects
    const citySel = document.getElementById('city');
    const districtSel = document.getElementById('district');
    const clinicSel = document.getElementById('clinic');
    const cityHelp = document.getElementById('cityHelp');
    const districtHelp = document.getElementById('districtHelp');
    const clinicHelp = document.getElementById('clinicHelp');

    (function initCities() {
      Object.keys(clinicDirectory).forEach(city => {
        const o = document.createElement('option');
        o.value = city; o.textContent = city; citySel.appendChild(o);
      });
    })();

    function resetSelectKeepPlaceholder(sel, placeholder) {
      const first = sel.options[0];
      if (first) {
        first.value = '';
        first.textContent = placeholder;
        sel.length = 1;
      } else {
        sel.innerHTML = '<option value="">' + placeholder + '</option>';
      }
      sel.selectedIndex = 0;
    }

    citySel.addEventListener('change', () => {
      cityHelp.textContent = '';
      resetSelectKeepPlaceholder(districtSel, '🏙️ İlçe seçiniz');
      resetSelectKeepPlaceholder(clinicSel, '🏥 Klinik seçiniz');
      clinicSel.disabled = true;

      const city = citySel.value;
      if (!city) { districtSel.disabled = true; return; }
      districtSel.disabled = false;

      Object.keys(clinicDirectory[city]).forEach(d => {
        const o = document.createElement('option'); o.value = d; o.textContent = d; districtSel.appendChild(o);
      });
    });

    districtSel.addEventListener('change', () => {
      districtHelp.textContent = '';
      resetSelectKeepPlaceholder(clinicSel, '🏥 Klinik seçiniz');
      const city = citySel.value, dist = districtSel.value;
      if (!city || !dist) { clinicSel.disabled = true; return; }
      const clinics = clinicDirectory[city][dist];
      clinics.forEach((c, idx) => {
        const o = document.createElement('option');
        o.value = idx; o.textContent = c.name; clinicSel.appendChild(o);
      });
      clinicSel.disabled = false;
    });

    // Step 1 submit
    const preForm = document.getElementById('preForm');
    const proc = document.getElementById('proc');
    const procHelp = document.getElementById('procHelp');
    const nextSection = document.getElementById('next');
    const calendarStep = document.getElementById('calendarStep');

    preForm.addEventListener('submit', function (e) {
      e.preventDefault();
      let ok = true;
      cityHelp.textContent = ''; districtHelp.textContent = ''; clinicHelp.textContent = ''; procHelp.textContent = '';
      if (!citySel.value) { cityHelp.textContent = 'Lütfen il seçiniz.'; ok = false; }
      if (!districtSel.value) { districtHelp.textContent = 'Lütfen ilçe seçiniz.'; ok = false; }
      if (clinicSel.disabled || clinicSel.value === '') { clinicHelp.textContent = 'Lütfen klinik seçiniz.'; ok = false; }
      if (!proc.value) { procHelp.textContent = 'Lütfen işlem tipi seçiniz.'; ok = false; }
      if (ok) {
        nextSection.hidden = false;
        // scroll fully to the next section
        setTimeout(() => nextSection.scrollIntoView({ behavior: 'smooth', block: 'start' }), 10);
      }
    });

    // DOB wheel
    const dobDay = document.getElementById('dobDay');
    const dobMonth = document.getElementById('dobMonth');
    const dobYear = document.getElementById('dobYear');
    (function buildDate() {
      const months = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
      const now = new Date(); const yMax = now.getFullYear(); const yMin = 1940;
      for (let y = yMax; y >= yMin; y--) { const o = document.createElement('option'); o.value = y; o.textContent = y; dobYear.appendChild(o); }
      for (let m = 1; m <= 12; m++) { const o = document.createElement('option'); o.value = m; o.textContent = months[m - 1]; dobMonth.appendChild(o); }
      fillDays();
      dobYear.addEventListener('change', fillDays);
      dobMonth.addEventListener('change', fillDays);
      function daysInMonth(y, m) { return new Date(y, m, 0).getDate(); }
      function fillDays() {
        const y = parseInt(dobYear.value || yMax, 10);
        const m = parseInt(dobMonth.value || 1, 10);
        const max = daysInMonth(y, m);
        dobDay.innerHTML = '';
        for (let d = 1; d <= max; d++) { const o = document.createElement('option'); o.value = d; o.textContent = d; dobDay.appendChild(o); }
      }
    })();

    // phone mask
    // phone mask (fix: typing shows progressively)
    const phone = document.getElementById('phone');
    phone.addEventListener('input', function () {
      let d = this.value.replace(/\D/g, '');
      if (d.startsWith('0')) d = d.slice(1);
      d = d.slice(0, 10);
      if (d.length > 0 && d[0] !== '5') d = '5' + d.slice(1);

      let out = '';
      // show up to first 3 digits inside parens while typing
      if (d.length > 0) out = '(' + d.slice(0, Math.min(3, d.length));
      if (d.length >= 3) out = '(' + d.slice(0, 3) + ')' + d.slice(3, 6);
      if (d.length > 6) out += '-' + d.slice(6, 8);
      if (d.length > 8) out += '-' + d.slice(8, 10);

      this.value = out;
    });


    // ID toggle + validation (single field)
    const nonCitizen = document.getElementById('nonCitizen');
    const idInput = document.getElementById('idInput');
    const idLabel = document.getElementById('idLabel');
    const idHelp = document.getElementById('idHelp');

    function syncIdMode() {
      if (nonCitizen.checked) {
        idLabel.childNodes[0].nodeValue = 'Pasaport Numarasi ';
        idInput.placeholder = 'Pasaport No';
        idInput.maxLength = 20;
        idInput.inputMode = 'text';
      } else {
        idLabel.childNodes[0].nodeValue = 'T.C. Kimlik Numarasi ';
        idInput.placeholder = '11 haneli TCKN';
        idInput.maxLength = 11;
        idInput.inputMode = 'numeric';
      }
      idHelp.textContent = '';
      idInput.value = '';
    }
    nonCitizen.addEventListener('change', syncIdMode);
    syncIdMode();

    // info submit
    const infoForm = document.getElementById('infoForm');
    const fullname = document.getElementById('fullname');
    const fullnameHelp = document.getElementById('fullnameHelp');
    const dobHelp = document.getElementById('dobHelp');
    const phoneHelp = document.getElementById('phoneHelp');
    const email = document.getElementById('email');
    const emailHelp = document.getElementById('emailHelp');

    infoForm.addEventListener('submit', function (e) {
      e.preventDefault();
      let valid = true;
      [idHelp, fullnameHelp, dobHelp, phoneHelp, emailHelp].forEach(el => el.textContent = '');

      const rawId = (idInput.value || '').trim();
      if (nonCitizen.checked) {
        if (!/^[A-Za-z0-9]{5,20}$/.test(rawId)) { idHelp.textContent = 'Geçerli bir pasaport numarası giriniz.'; valid = false; }
      } else {
        if (!/^\d{11}$/.test(rawId)) { idHelp.textContent = 'Geçerli bir TCKN giriniz (11 hane).'; valid = false; }
      }
      if (!fullname.value.trim()) { fullnameHelp.textContent = 'Ad soyad zorunludur.'; valid = false; }
      if (!dobDay.value || !dobMonth.value || !dobYear.value) { dobHelp.textContent = 'Doğum tarihi zorunludur.'; valid = false; }

      const phoneDigits = phone.value.replace(/\D/g, '');
      const hasPhone = phoneDigits.length === 10 && phoneDigits.startsWith('5');
      const hasEmail = email.value.trim().length > 0;
      if (!hasPhone && !hasEmail) {
        phoneHelp.textContent = 'Telefon veya e‑posta giriniz.';
        emailHelp.textContent = 'Telefon veya e‑posta giriniz.';
        valid = false;
      } else if (hasEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) {
        emailHelp.textContent = 'Geçerli bir e‑posta giriniz.'; valid = false;
      }
      if (valid) {
        calendarStep.hidden = false;
        setTimeout(() => {
          // Önce takvim bölümüne kaydır
          calendarStep.scrollIntoView({ behavior: 'smooth', block: 'start' });

          // Ardından biraz aşağı indir
          setTimeout(() => {
            window.scrollBy({ top: 375, behavior: 'smooth' }); // buradaki 100px'i ihtiyacına göre değiştir
          }, 400); // scrollIntoView animasyonu başlaması için bekleme süresi
        }, 10);
      }
    });

    // calendar + slots
    const monthLabel = document.getElementById('monthLabel');
    const daysWrap = document.getElementById('days');
    const slotsWrap = document.getElementById('slotsWrap');
    const slotGrid = document.getElementById('slotGrid');
    const prevBtn = document.getElementById('prevMonth');
    const nextBtn = document.getElementById('nextMonth');
    const completeBtn = document.getElementById('completeBtn');

    let viewDate = new Date(); viewDate.setDate(1);
    let selectedDate = null, selectedTime = null;

    const monthNames = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];

    function buildCalendar() {
      daysWrap.innerHTML = '';
      monthLabel.textContent = monthNames[viewDate.getMonth()] + ' ' + viewDate.getFullYear();

      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const padStart = (firstDay.getDay() + 6) % 7;
      const totalDays = lastDay.getDate();

      for (let i = 0; i < padStart; i++) {
        const blank = document.createElement('div'); blank.className = 'day disabled'; blank.textContent = '';
        daysWrap.appendChild(blank);
      }
      for (let d = 1; d <= totalDays; d++) {
        const cell = document.createElement('button');
        cell.type = 'button'; cell.className = 'day'; cell.textContent = d;
        const cellDate = new Date(year, month, d);
        const today = new Date(); today.setHours(0, 0, 0, 0);
        if (cellDate < today) { cell.classList.add('disabled'); cell.disabled = true; }
        if (selectedDate && sameDate(cellDate, selectedDate)) { cell.classList.add('selected'); }
        cell.addEventListener('click', () => {
          if (cell.disabled) return;
          selectedDate = new Date(year, month, d);
          document.querySelectorAll('.day.selected').forEach(el => el.classList.remove('selected'));
          cell.classList.add('selected');
          selectedTime = null;
          showSlotsFor(selectedDate);
          completeBtn.disabled = true;
        });
        daysWrap.appendChild(cell);
      }
      if (!selectedDate || selectedDate.getMonth() !== month || selectedDate.getFullYear() !== year) { slotsWrap.hidden = true; }
    }
    function sameDate(a, b) { return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate(); }
    prevBtn.addEventListener('click', () => { viewDate.setMonth(viewDate.getMonth() - 1); buildCalendar(); });
    nextBtn.addEventListener('click', () => { viewDate.setMonth(viewDate.getMonth() + 1); buildCalendar(); });

    function showSlotsFor(date) {
      slotsWrap.hidden = false;
      slotGrid.innerHTML = '';
      const slots = ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'];
      const now = new Date();
      const isToday = sameDate(date, now);
      slots.forEach((t, i) => {
        const b = document.createElement('button');
        b.type = 'button'; b.className = 'slot'; b.textContent = t;
        // örnek engelli saatler
        if (i === 3 || i === 6 || i === 13) { b.disabled = true; }
        // bugünün geçmiş saatleri devre dışı
        if (isToday) {
          const [hh, mm] = t.split(':').map(Number);
          const slotDate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), hh, mm, 0, 0);
          if (slotDate <= now) { b.disabled = true; }
        }
        b.addEventListener('click', () => {
          if (b.disabled) return;
          document.querySelectorAll('.slot.selected').forEach(el => el.classList.remove('selected'));
          b.classList.add('selected');
          selectedTime = t;
          completeBtn.disabled = false;
        });
        slotGrid.appendChild(b);
      });
      slotsWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // summary modal
    const backdrop = document.getElementById('summaryBackdrop');
    const summaryList = document.getElementById('summaryList');
    const closeSummary = document.getElementById('closeSummary');
    const saveSummary = document.getElementById('saveSummary');

    function fmtDate(d) {
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yyyy = d.getFullYear();
      return dd + '.' + mm + '.' + yyyy;
    }

    function getSelectedClinicInfo() {
      const city = citySel.value, dist = districtSel.value, idx = Number(clinicSel.value || 0);
      const c = clinicDirectory[city][dist][idx];
      return c || { name: '-', address: '-' };
    }

    function mapsDirectionsUrl(query) {
      const enc = encodeURIComponent(query);
      const ua = navigator.userAgent || '';
      const isApple = /iPad|iPhone|Macintosh/.test(ua);
      return isApple
        ? ('https://maps.apple.com/?daddr=' + enc)
        : ('https://www.google.com/maps/dir/?api=1&destination=' + enc);
    }


    function openSummary() {
      summaryList.innerHTML = '';
      const idValue = (idInput.value || '').trim();
      const clinicInfo = getSelectedClinicInfo();
      const items = [
        ['__HEADER__', 'Klinik Bilgileri'],
        ['İl', citySel.value || '-'],
        ['İlçe', districtSel.value || '-'],
        ['Klinik', clinicInfo.name],
        ['Klinik Adresi',`<a href="${clinicInfo.mapLink}" target="_blank" style="color:blue; text-decoration:underline;">${clinicInfo.address}</a>`],
        ['İşlem Tipi', proc.value || '-'],
        //['Tarih', selectedDate ? fmtDate(selectedDate) : '-'],
        ['Saat', selectedTime || '-'],
        ['__HEADER__', 'Hasta Bilgileri'],
        ['Ad Soyad', (fullname.value || '-')],
        //[nonCitizen.checked ? 'Pasaport No' : 'TCKN', idValue || '-'],
        //['Telefon', (phone.value || '-')],
        //['E-posta', (email.value || '-')]
      ];
      items.forEach(([k, v]) => {
        const li = document.createElement('li');
        if (k === '__HEADER__') {
          li.innerHTML = `<strong style="font-size:16px; color:${'var(--navy)'}; margin-top:8px; display:block;">${v}</strong>`;
        } else {
          li.innerHTML = `<div class="summary-key">${k}:</div><div>${v ? String(v) : '-'}</div>`;
        }
        summaryList.appendChild(li);
      });
      backdrop.style.display = 'flex';
    }
    function closeModal() { backdrop.style.display = 'none'; }

    document.getElementById('completeBtn').addEventListener('click', () => {
      if (!selectedDate || !selectedTime) return;
      openSummary();
    });
    // One-click actions (no extra confirmation)
    closeSummary.addEventListener('click', () => { closeModal(); openInfo('İşlem iptal edildi.'); });
    saveSummary.addEventListener('click', () => { closeModal(); resetAll(); openInfo('Randevunuz kaydedildi.'); });
    backdrop.addEventListener('click', (e) => { if (e.target === backdrop) closeModal(); });

    // confirm + info modals
    const confirmBackdrop = document.getElementById('confirmBackdrop');
    const confirmMessage = document.getElementById('confirmMessage');
    const confirmYes = document.getElementById('confirmYes');
    const confirmNo = document.getElementById('confirmNo');

    function openConfirm(message, onYes) {
      confirmMessage.textContent = message;
      confirmBackdrop.style.display = 'flex';
      const yesHandler = () => { confirmBackdrop.style.display = 'none'; confirmYes.removeEventListener('click', yesHandler); onYes && onYes(); };
      const noHandler = () => { confirmBackdrop.style.display = 'none'; confirmNo.removeEventListener('click', noHandler); };
      confirmYes.addEventListener('click', yesHandler, { once: true });
      confirmNo.addEventListener('click', noHandler, { once: true });
    }

    const infoBackdrop = document.getElementById('infoBackdrop');
    const infoMessage = document.getElementById('infoMessage');
    const infoClose = document.getElementById('infoClose');
    function openInfo(message) { infoMessage.textContent = message; infoBackdrop.style.display = 'flex'; }
    infoClose.addEventListener('click', () => infoBackdrop.style.display = 'none');

    // reset app to initial state after successful save
    function resetAll() {
      try {
        // Step 1 form
        citySel.value = '';
        districtSel.disabled = true;
        districtSel.innerHTML = '<option value="">Ilce giriniz</option>';
        clinicSel.disabled = true;
        clinicSel.innerHTML = '<option value="">Klinik seciniz</option>';
        proc.value = '';
        cityHelp.textContent = '';
        districtHelp.textContent = '';
        clinicHelp.textContent = '';
        procHelp.textContent = '';

        // Step 2 form
        nonCitizen.checked = false;
        syncIdMode();
        idInput.value = '';
        fullname.value = '';
        if (dobDay) dobDay.value = '';
        if (dobMonth) dobMonth.value = '';
        if (dobYear) dobYear.value = '';
        phone.value = '';
        email.value = '';
        [idHelp, fullnameHelp, dobHelp, phoneHelp, emailHelp].forEach(el => el.textContent = '');

        // Hide subsequent sections
        document.getElementById('next').hidden = true;
        document.getElementById('calendarStep').hidden = true;

        // Reset calendar state
        selectedDate = null;
        selectedTime = null;
        viewDate = new Date();
        viewDate.setDate(1);
        if (typeof buildCalendar === 'function') buildCalendar();
        slotsWrap.hidden = true;
        slotGrid.innerHTML = '';
        completeBtn.disabled = true;

        // Scroll to top/hero
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (_) {
        // no-op if any element not present
      }
    }

    // init calendar when visible
    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) { buildCalendar(); obs.disconnect(); }
      });
    }, { threshold: 0.2 });
    obs.observe(calendarStep);

    // Perf: scroll sırasında ağır arka plan animasyonlarını duraklat
    (function optimizeScrollAnimations() {
      let t = null;
      window.addEventListener('scroll', () => {
        document.body.classList.add('scrolling');
        if (t) clearTimeout(t);
        t = setTimeout(() => document.body.classList.remove('scrolling'), 120);
      }, { passive: true });
    })();
  </script>

  <!-- Floating Contact Widget -->
  <div class="contact-widget" aria-label="Iletisim">
    <a class="contact-fab" href="#" aria-haspopup="true" aria-expanded="false" tabindex="0" title="Iletisim">
      <span class="phone-icon" aria-hidden="true">📞</span>
    </a>
    <div class="bubbles">
      <a class="bubble" href="https://www.instagram.com/rterdogan" target="_blank" rel="noopener noreferrer"
        title="Instagram">
        <span class="icon">
          <img src="insta.png" alt="Instagram" style="width:20px; height:20px; vertical-align:middle;">
        </span>
        <span>Instagram</span>
      </a>
      <a class="bubble" href="https://www.facebook.com/RTErdogan" target="_blank" rel="noopener noreferrer"
        title="Facebook">
        <span class="icon">
          <img src="facebooklogo.png" alt="Facebook" style="width:20px; height:20px; vertical-align:middle;">
        </span>
        <span>Facebook</span>

      </a>
      <a class="bubble" href="https://www.youtube.com/@RTErdogan" target="_blank" rel="noopener noreferrer"
        title="YouTube">
        <span class="icon">
          <img src="youtubelogo.png" alt="YouTube" style="width:20px; height:20px; vertical-align:middle;">
        </span>
        <span>YouTube</span>
      </a>

      <a class="bubble" href="https://wa.me/905497195699?text=Merhaba!" target="_blank" rel="noopener noreferrer"
        title="WhatsApp">
        <span class="icon">
          <img src="whatsapp.png" alt="WhatsApp" style="width:20px; height:20px; vertical-align:middle;">
        </span>
        <span>WhatsApp</span>
      </a>

    </div>
  </div>
</body>

</html>

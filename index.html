
<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Varol Klinigi | Hos Geldiniz</title>
  <meta name="description" content="Dis klinigi randevu ekrani" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* palette */
      --navy: #0a2540;
      --blue: #1e90ff;
      --gold: #d4af37;
      --bg: #f4f8ff;
      --card: #ffffff;
      --text: #0b1118;
      --muted: #3e5876;
      --radius: 16px;
      --danger: #d62828;
      --overlay: rgba(0, 0, 0, .5);
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: 'Poppins', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, #e7f1ff 0%, rgba(231, 241, 255, 0) 60%),
        radial-gradient(900px 700px at 110% 10%, #dfeaff 0%, rgba(231, 241, 255, 0) 55%),
        var(--bg);
      overflow-x: hidden;
    }

    /* background teeth */
    .bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }

    .tooth {
      position: absolute;
      width: 48px;
      height: 48px;
      opacity: .10;
      animation: fall 18s linear infinite;
      will-change: transform, opacity;
      filter: drop-shadow(0 0 6px rgba(30, 144, 255, .22));
      color: var(--blue);
    }

    .sm {
      width: 28px;
      height: 28px;
      animation-duration: 20s;
      opacity: .14
    }

    .lg {
      width: 68px;
      height: 68px;
      animation-duration: 24s;
      opacity: .08
    }

    @keyframes fall {
      from {
        transform: translate3d(var(--x, 0vw), -20vh, 0) rotate(0turn);
      }

      to {
        transform: translate3d(var(--x, 0vw), 110vh, 0) rotate(1turn);
      }
    }

    /* header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 22px;
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(10, 37, 64, .97), rgba(10, 37, 64, .86));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255, 255, 255, .08);
      color: #fff;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .logo {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 12px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .08);
    }

    .brand-name {
      font-weight: 700;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      appearance: none;
      border: 0;
      cursor: pointer;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700;
      color: #0a2540;
      background: var(--gold);
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
      box-shadow: 0 10px 30px rgba(212, 175, 55, .25), inset 0 0 0 1px rgba(0, 0, 0, .06);
    }

    .btn:hover {
      transform: translateY(-1px)
    }

    .btn:disabled {
      opacity: .55;
      cursor: not-allowed
    }

    /* hero */
    .hero {
      max-width: 1100px;
      margin: 8vh auto 0;
      padding: 0 22px;
      text-align: center;
    }

    h1 {
      margin: 18px 0 10px;
      line-height: 1.08;
      font-size: clamp(28px, 6vw, 52px);
      letter-spacing: .2px;
      color: var(--navy);
    }

    .lead {
      margin: 8px auto 22px;
      max-width: 760px;
      font-size: clamp(15px, 2.2vw, 18px);
      color: var(--muted);
    }

    /* card */
    .card {
      margin: 28px auto 40px;
      max-width: 900px;
      padding: 22px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .97), rgba(255, 255, 255, .90));
      border: 1px solid rgba(0, 0, 0, .06);
      border-radius: var(--radius);
      box-shadow: 0 20px 60px rgba(0, 0, 0, .10);
    }

    /* vertical form */
    .form-vertical {
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: stretch;
      max-width: 560px;
      margin: 0 auto;
    }

    .field {
      display: flex;
      flex-direction: column;
      text-align: left;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: var(--navy);
    }

    .req {
      color: var(--danger);
      margin-left: 6px;
    }

    select,
    input[type="text"],
    input[type="tel"],
    input[type="email"] {
      padding: 14px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, .12);
      background: #fff;
      font-size: 16px;
      outline: none;
    }

    .helper {
      color: var(--danger);
      font-size: 12px;
      min-height: 16px;
      margin-top: 6px;
    }

    /* date wheel */
    .date-wheel {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
      padding: 12px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .12);
      font-size: 18px;
    }

    .date-wheel select {
      appearance: none;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, .08);
      background: #fff;
      font-size: 16px;
      text-align: center;
    }

    /* calendar */
    #calendarStep .title {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 12px;
      color: var(--navy);
    }

    .cal {
      max-width: 760px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .12);
      border-radius: 16px;
      padding: 16px;
    }

    .cal-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .cal-head .month {
      font-weight: 700;
      font-size: 18px;
      color: var(--navy);
    }

    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .dow {
      text-align: center;
      font-weight: 600;
      color: #4b5563;
      padding: 8px 0;
    }

    .day {
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, .08);
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      background: #f7fbff;
    }

    .day:hover {
      outline: 2px solid rgba(30, 144, 255, .35);
    }

    .day.disabled {
      opacity: .35;
      cursor: not-allowed;
      text-decoration: line-through;
      background: #f1f5f9;
    }

    .day.selected {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }

    .slots {
      margin-top: 18px;
    }

    .slots h3 {
      margin: 0 0 10px;
      font-size: 18px;
      color: var(--navy);
    }

    .slot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 10px;
    }

    .slot {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, .12);
      background: #fff;
      cursor: pointer;
      font-weight: 700;
      text-align: center;
      color: var(--navy);
    }

    .slot[disabled] {
      opacity: .4;
      cursor: not-allowed;
      text-decoration: line-through;
    }

    .slot.selected {
      background: var(--navy);
      color: #fff;
      border-color: var(--navy);
    }

    /* modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: var(--overlay);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
    }

    .modal {
      background: #fff;
      border-radius: 16px;
      max-width: 680px;
      width: 100%;
      border: 1px solid rgba(0, 0, 0, .08);
      box-shadow: 0 20px 60px rgba(0, 0, 0, .25);
      padding: 18px;
    }

    .modal h3 {
      margin: 0 0 10px;
      font-size: 20px;
      color: var(--navy);
    }

    .summary-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 8px;
    }

    .summary-list li {
      display: flex;
      gap: 8px;
    }

    .summary-key {
      min-width: 160px;
      font-weight: 600;
      color: #374151;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 14px;
    }
  </style>
</head>

<body>
  <!-- background teeth -->
  <div class="bg" aria-hidden="true" id="bg"></div>

  <!-- header -->
  <header>
    <div class="brand">
      <img class="logo" id="siteLogo" src="kucuklogo.jpg" alt="Klinik logosu" />
      <div class="brand-name" id="brandName">Varol Klinigi</div>
    </div>
    <nav class="actions" aria-label="Hizli Islemler">
      <button class="btn" type="button">Men√º</button>
    </nav>
  </header>

  <!-- main -->
  <main>
    <section class="hero">
      <h1>Kolay Randevu, Saglikli Gulus</h1>

      <div class="card" role="region" aria-label="Randevu Formu">
        <!-- STEP 1: location -> clinic -> procedure -->
        <form id="preForm" class="form-vertical" novalidate>
          <div class="field">
            <label for="city">Il<span class="req">*</span></label>
            <select id="city" required>
              <option value="">Seciniz</option>
            </select>
            <div class="helper" id="cityHelp"></div>
          </div>

          <div class="field">
            <label for="district">Ilce<span class="req">*</span></label>
            <select id="district" required disabled>
              <option value="">Once il seciniz</option>
            </select>
            <div class="helper" id="districtHelp"></div>
          </div>

          <div class="field">
            <label for="clinic">Klinik Secimi<span class="req">*</span></label>
            <select id="clinic" required disabled>
              <option value="">Once ilce seciniz</option>
            </select>
            <div class="helper" id="clinicHelp"></div>
          </div>

          <div class="field">
            <label for="proc">Islem Tipi<span class="req">*</span></label>
            <select id="proc" required>
              <option value="">Seciniz</option>
              <option>Genel Muayene</option>
              <option>Dis Tasi Temizligi</option>
              <option>Dis Beyazlatma</option>
              <option>Dis Cekimi</option>
              <option>Dis Dolguleri</option>
              <option>Implant</option>
              <option>Kanal Tedavisi</option>
              <option>Ortodonti</option>
              <option>Kaplama</option>
            </select>
            <div class="helper" id="procHelp"></div>
          </div>

          <button type="submit" class="btn" id="nextBtn">Ileri</button>
        </form>
      </div>
    </section>

    <!-- STEP 2: personal info -->
    <section id="next" hidden>
      <div class="card">
        <form id="infoForm" class="form-vertical" novalidate>
          <!-- single ID field -->
          <div class="field" id="idField">
            <label for="idInput" id="idLabel">T.C. Kimlik Numarasi <span class="req">*</span></label>
            <input type="text" id="idInput" maxlength="11" inputmode="numeric" placeholder="11 haneli TCKN">
            <div class="helper" id="idHelp"></div>
          </div>

          <!-- checkbox under the field -->
          <div class="field" style="display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="nonCitizen" />
            <label for="nonCitizen" style="font-weight:600;">TC vatandasi degilim</label>
          </div>

          <div class="field">
            <label for="fullname">Ad Soyad<span class="req">*</span></label>
            <input type="text" id="fullname" placeholder="Ad Soyad">
            <div class="helper" id="fullnameHelp"></div>
          </div>

          <div class="field">
            <label>Dogum Tarihi<span class="req">*</span></label>
            <div class="date-wheel">
              <select id="dobDay"></select>
              <select id="dobMonth"></select>
              <select id="dobYear"></select>
            </div>
            <div class="helper" id="dobHelp"></div>
          </div>

          <div class="field">
            <label for="phone">Telefon (5xx)xxx-xx-xx</label>
            <input type="tel" id="phone" placeholder="(5__)___-__-__" inputmode="numeric" maxlength="16">
            <div class="helper" id="phoneHelp"></div>
          </div>

          <div class="field">
            <label for="email">E-posta</label>
            <input type="email" id="email" placeholder="ornek@mail.com">
            <div class="helper" id="emailHelp"></div>
          </div>

          <button type="submit" class="btn" id="finishBtn">Devam Et</button>
        </form>
      </div>
    </section>

    <!-- STEP 3: calendar & slots -->
    <section id="calendarStep" hidden>
      <div class="card">
        <div class="title">Randevu Takvim</div>
        <div class="cal" id="calendar">
          <div class="cal-head">
            <button class="btn" type="button" id="prevMonth">&#9664;</button>
            <div class="month" id="monthLabel">Ay Yil</div>
            <button class="btn" type="button" id="nextMonth">&#9654;</button>
          </div>
          <div class="cal-grid" id="dow">
            <div class="dow">Pzt</div>
            <div class="dow">Sal</div>
            <div class="dow">Car</div>
            <div class="dow">Per</div>
            <div class="dow">Cum</div>
            <div class="dow">Cmt</div>
            <div class="dow">Paz</div>
          </div>
          <div class="cal-grid" id="days"></div>
        </div>

        <div class="slots" id="slotsWrap" hidden>
          <h3>Randevu Saati</h3>
          <div class="slot-grid" id="slotGrid"></div>
          <div style="margin-top:12px; display:flex; justify-content:flex-end;">
            <button type="button" class="btn" id="completeBtn" disabled>Randevuyu Tamamla</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- SUMMARY MODAL -->
  <div class="modal-backdrop" id="summaryBackdrop" role="dialog" aria-modal="true" aria-labelledby="summaryTitle">
    <div class="modal">
      <h3 id="summaryTitle">Randevu Ozeti</h3>
      <ul class="summary-list" id="summaryList"></ul>
      <div class="modal-actions">
        <button type="button" class="btn" id="closeSummary">Kapat</button>
      </div>
    </div>
  </div>

  <!-- tooth symbol -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="tooth" viewBox="0 0 64 64">
      <path fill="currentColor"
        d="M45.4 6.8c-4.7-.8-8.6.5-13.4 3.1-4.9-2.6-8.8-3.9-13.5-3.1C6.8 8.8 2.7 19.6 8 29.9c6.9 13.6 9.2 14.2 11.1 14.2 4.1 0 4.7-6.8 7.2-6.8 2.6 0 3.2 6.8 7.3 6.8 1.9 0 4.3-.6 11.2-14.2 5.3-10.3 1.2-21.1-9.4-23.1zM26 12.6c1.1-.6 2.2-1.1 3.3-1.6l.1-.1.1.1c1.1.5 2.2 1 3.3 1.6 1.4.8 2.5 2.1 2.9 3.7.2.9-.3 1.9-1.2 2.1-.8.2-1.6-.3-1.8-1.1-.2-.8-.7-1.5-1.5-1.9-.5-.3-1-.5-1.8-.9-.8.4-1.3.6-1.8.9-.7.4-1.3 1.1-1.5 1.9-.2.8-1 1.3-1.8 1.1-.9-.2-1.4-1.2-1.2-2.1.3-1.6 1.4-2.9 2.9-3.7z" />
    </symbol>
  </svg>

  <script>
    // background teeth
    (function spawnTeeth() {
      const bg = document.getElementById('bg');
      const total = 40;
      for (let i = 0; i < total; i++) {
        const s = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        s.setAttribute('class', 'tooth');
        if (i % 5 === 0) s.classList.add('lg');
        if (i % 3 === 0) s.classList.add('sm');
        const leftBias = i < total / 2;
        const x = leftBias ? (Math.random() * 30) : (Math.random() * 100);
        s.style.setProperty('--x', x + 'vw');
        s.style.top = (-Math.random() * 100) + 'vh';
        s.style.animationDelay = (Math.random() * -20) + 's';
        s.setAttribute('viewBox', '0 0 64 64');
        s.innerHTML = '<use href="#tooth"></use>';
        bg.appendChild(s);
      }
    })();

    // sample clinic directory (update addresses as needed)
    const clinicDirectory = {
      "Istanbul": {
        "Bagcilar": [
          { name: "Varol Klinigi Bagcilar", address: "Adres - Bagcilar, Istanbul" }
        ],
        "Kadikoy": [
          { name: "Varol Klinigi Kadikoy", address: "Adres - Kadikoy, Istanbul" }
        ]
      },
      "Ankara": {
        "Cankaya": [
          { name: "Varol Klinigi Cankaya", address: "Adres - Cankaya, Ankara" }
        ]
      },
      "Izmir": {
        "Konak": [
          { name: "Varol Klinigi Konak", address: "Adres - Konak, Izmir" }
        ]
      },
      "Bursa": {
        "Nilufer": [
          { name: "Varol Klinigi Nilufer", address: "Adres - Nilufer, Bursa" }
        ],
        "Osmangazi": [
          { name: "Varol Klinigi Osmangazi", address: "Adres - Osmangazi, Bursa" }
        ]
      },
      "Antalya": {
        "Muratpasa": [
          { name: "Varol Klinigi Muratpasa", address: "Adres - Muratpasa, Antalya" }
        ]
      }
    };

    // Step 1: cascading selects
    const citySel = document.getElementById('city');
    const districtSel = document.getElementById('district');
    const clinicSel = document.getElementById('clinic');
    const cityHelp = document.getElementById('cityHelp');
    const districtHelp = document.getElementById('districtHelp');
    const clinicHelp = document.getElementById('clinicHelp');

    (function initCities() {
      Object.keys(clinicDirectory).forEach(city => {
        const o = document.createElement('option');
        o.value = city; o.textContent = city; citySel.appendChild(o);
      });
    })();

    citySel.addEventListener('change', () => {
      cityHelp.textContent = '';
      districtSel.innerHTML = '<option value="">Seciniz</option>';
      clinicSel.innerHTML = '<option value="">Once ilce seciniz</option>';
      clinicSel.disabled = true;

      const city = citySel.value;
      if (!city) { districtSel.disabled = true; return; }
      districtSel.disabled = false;

      Object.keys(clinicDirectory[city]).forEach(d => {
        const o = document.createElement('option'); o.value = d; o.textContent = d; districtSel.appendChild(o);
      });
    });

    districtSel.addEventListener('change', () => {
      districtHelp.textContent = '';
      clinicSel.innerHTML = '<option value="">Seciniz</option>';
      const city = citySel.value, dist = districtSel.value;
      if (!city || !dist) { clinicSel.disabled = true; return; }
      const clinics = clinicDirectory[city][dist];
      clinics.forEach((c, idx) => {
        const o = document.createElement('option');
        o.value = idx; o.textContent = c.name; clinicSel.appendChild(o);
      });
      clinicSel.disabled = false;
    });

    // Step 1 submit
    const preForm = document.getElementById('preForm');
    const proc = document.getElementById('proc');
    const procHelp = document.getElementById('procHelp');
    const nextSection = document.getElementById('next');
    const calendarStep = document.getElementById('calendarStep');

    preForm.addEventListener('submit', function (e) {
      e.preventDefault();
      let ok = true;
      cityHelp.textContent = ''; districtHelp.textContent = ''; clinicHelp.textContent = ''; procHelp.textContent = '';
      if (!citySel.value) { cityHelp.textContent = 'Lutfen il seciniz.'; ok = false; }
      if (!districtSel.value) { districtHelp.textContent = 'Lutfen ilce seciniz.'; ok = false; }
      if (clinicSel.disabled || clinicSel.value === '') { clinicHelp.textContent = 'Lutfen klinik seciniz.'; ok = false; }
      if (!proc.value) { procHelp.textContent = 'Lutfen islem tipi seciniz.'; ok = false; }
      if (ok) { nextSection.hidden = false; nextSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
    });

    // DOB wheel
    const dobDay = document.getElementById('dobDay');
    const dobMonth = document.getElementById('dobMonth');
    const dobYear = document.getElementById('dobYear');
    (function buildDate() {
      const months = ['Ocak', 'Subat', 'Mart', 'Nisan', 'Mayis', 'Haziran', 'Temmuz', 'Agustos', 'Eylul', 'Ekim', 'Kasim', 'Aralik'];
      const now = new Date(); const yMax = now.getFullYear(); const yMin = 1940;
      for (let y = yMax; y >= yMin; y--) { const o = document.createElement('option'); o.value = y; o.textContent = y; dobYear.appendChild(o); }
      for (let m = 1; m <= 12; m++) { const o = document.createElement('option'); o.value = m; o.textContent = months[m - 1]; dobMonth.appendChild(o); }
      fillDays();
      dobYear.addEventListener('change', fillDays);
      dobMonth.addEventListener('change', fillDays);
      function daysInMonth(y, m) { return new Date(y, m, 0).getDate(); }
      function fillDays() {
        const y = parseInt(dobYear.value || yMax, 10);
        const m = parseInt(dobMonth.value || 1, 10);
        const max = daysInMonth(y, m);
        dobDay.innerHTML = '';
        for (let d = 1; d <= max; d++) { const o = document.createElement('option'); o.value = d; o.textContent = d; dobDay.appendChild(o); }
      }
    })();

    // phone mask
    // phone mask (fix: typing shows progressively)
    const phone = document.getElementById('phone');
    phone.addEventListener('input', function () {
      let d = this.value.replace(/\D/g, '');
      if (d.startsWith('0')) d = d.slice(1);
      d = d.slice(0, 10);
      if (d.length > 0 && d[0] !== '5') d = '5' + d.slice(1);

      let out = '';
      // show up to first 3 digits inside parens while typing
      if (d.length > 0) out = '(' + d.slice(0, Math.min(3, d.length));
      if (d.length >= 3) out = '(' + d.slice(0, 3) + ')' + d.slice(3, 6);
      if (d.length > 6) out += '-' + d.slice(6, 8);
      if (d.length > 8) out += '-' + d.slice(8, 10);

      this.value = out;
    });


    // ID toggle + validation (single field)
    const nonCitizen = document.getElementById('nonCitizen');
    const idInput = document.getElementById('idInput');
    const idLabel = document.getElementById('idLabel');
    const idHelp = document.getElementById('idHelp');

    function syncIdMode() {
      if (nonCitizen.checked) {
        idLabel.childNodes[0].nodeValue = 'Pasaport Numarasi ';
        idInput.placeholder = 'Pasaport No';
        idInput.maxLength = 20;
        idInput.inputMode = 'text';
      } else {
        idLabel.childNodes[0].nodeValue = 'T.C. Kimlik Numarasi ';
        idInput.placeholder = '11 haneli TCKN';
        idInput.maxLength = 11;
        idInput.inputMode = 'numeric';
      }
      idHelp.textContent = '';
      idInput.value = '';
    }
    nonCitizen.addEventListener('change', syncIdMode);
    syncIdMode();

    // info submit
    const infoForm = document.getElementById('infoForm');
    const fullname = document.getElementById('fullname');
    const fullnameHelp = document.getElementById('fullnameHelp');
    const dobHelp = document.getElementById('dobHelp');
    const phoneHelp = document.getElementById('phoneHelp');
    const email = document.getElementById('email');
    const emailHelp = document.getElementById('emailHelp');

    infoForm.addEventListener('submit', function (e) {
      e.preventDefault();
      let valid = true;
      [idHelp, fullnameHelp, dobHelp, phoneHelp, emailHelp].forEach(el => el.textContent = '');

      const rawId = (idInput.value || '').trim();
      if (nonCitizen.checked) {
        if (!/^[A-Za-z0-9]{5,20}$/.test(rawId)) { idHelp.textContent = 'Gecerli bir pasaport numarasi giriniz.'; valid = false; }
      } else {
        if (!/^\d{11}$/.test(rawId)) { idHelp.textContent = 'Gecerli bir TCKN giriniz (11 hane).'; valid = false; }
      }
      if (!fullname.value.trim()) { fullnameHelp.textContent = 'Ad soyad zorunludur.'; valid = false; }
      if (!dobDay.value || !dobMonth.value || !dobYear.value) { dobHelp.textContent = 'Dogum tarihi zorunludur.'; valid = false; }

      const phoneDigits = phone.value.replace(/\D/g, '');
      const hasPhone = phoneDigits.length === 10 && phoneDigits.startsWith('5');
      const hasEmail = email.value.trim().length > 0;
      if (!hasPhone && !hasEmail) {
        phoneHelp.textContent = 'Telefon veya e-posta giriniz.';
        emailHelp.textContent = 'Telefon veya e-posta giriniz.';
        valid = false;
      } else if (hasEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) {
        emailHelp.textContent = 'Gecerli bir e-posta giriniz.'; valid = false;
      }

      if (valid) {
        calendarStep.hidden = false;
        calendarStep.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });

    // calendar + slots
    const monthLabel = document.getElementById('monthLabel');
    const daysWrap = document.getElementById('days');
    const slotsWrap = document.getElementById('slotsWrap');
    const slotGrid = document.getElementById('slotGrid');
    const prevBtn = document.getElementById('prevMonth');
    const nextBtn = document.getElementById('nextMonth');
    const completeBtn = document.getElementById('completeBtn');

    let viewDate = new Date(); viewDate.setDate(1);
    let selectedDate = null, selectedTime = null;

    const monthNames = ['Ocak', 'Subat', 'Mart', 'Nisan', 'Mayis', 'Haziran', 'Temmuz', 'Agustos', 'Eylul', 'Ekim', 'Kasim', 'Aralik'];

    function buildCalendar() {
      daysWrap.innerHTML = '';
      monthLabel.textContent = monthNames[viewDate.getMonth()] + ' ' + viewDate.getFullYear();

      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const padStart = (firstDay.getDay() + 6) % 7;
      const totalDays = lastDay.getDate();

      for (let i = 0; i < padStart; i++) {
        const blank = document.createElement('div'); blank.className = 'day disabled'; blank.textContent = '';
        daysWrap.appendChild(blank);
      }
      for (let d = 1; d <= totalDays; d++) {
        const cell = document.createElement('button');
        cell.type = 'button'; cell.className = 'day'; cell.textContent = d;
        const cellDate = new Date(year, month, d);
        const today = new Date(); today.setHours(0, 0, 0, 0);
        if (cellDate < today) { cell.classList.add('disabled'); cell.disabled = true; }
        if (selectedDate && sameDate(cellDate, selectedDate)) { cell.classList.add('selected'); }
        cell.addEventListener('click', () => {
          if (cell.disabled) return;
          selectedDate = new Date(year, month, d);
          document.querySelectorAll('.day.selected').forEach(el => el.classList.remove('selected'));
          cell.classList.add('selected');
          selectedTime = null;
          showSlotsFor(selectedDate);
          completeBtn.disabled = true;
        });
        daysWrap.appendChild(cell);
      }
      if (!selectedDate || selectedDate.getMonth() !== month || selectedDate.getFullYear() !== year) { slotsWrap.hidden = true; }
    }
    function sameDate(a, b) { return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate(); }
    prevBtn.addEventListener('click', () => { viewDate.setMonth(viewDate.getMonth() - 1); buildCalendar(); });
    nextBtn.addEventListener('click', () => { viewDate.setMonth(viewDate.getMonth() + 1); buildCalendar(); });

    function showSlotsFor(date) {
      slotsWrap.hidden = false;
      slotGrid.innerHTML = '';
      const slots = ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'];
      slots.forEach((t, i) => {
        const b = document.createElement('button');
        b.type = 'button'; b.className = 'slot'; b.textContent = t;
        if (i === 3 || i === 6 || i === 13) { b.disabled = true; }
        b.addEventListener('click', () => {
          if (b.disabled) return;
          document.querySelectorAll('.slot.selected').forEach(el => el.classList.remove('selected'));
          b.classList.add('selected');
          selectedTime = t;
          completeBtn.disabled = false;
        });
        slotGrid.appendChild(b);
      });
      slotsWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // summary modal
    const backdrop = document.getElementById('summaryBackdrop');
    const summaryList = document.getElementById('summaryList');
    const closeSummary = document.getElementById('closeSummary');

    function fmtDate(d) {
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yyyy = d.getFullYear();
      return dd + '.' + mm + '.' + yyyy;
    }

    function getSelectedClinicInfo() {
      const city = citySel.value, dist = districtSel.value, idx = Number(clinicSel.value || 0);
      const c = clinicDirectory[city][dist][idx];
      return c || { name: '-', address: '-' };
    }

    function openSummary() {
      summaryList.innerHTML = '';
      const idValue = (idInput.value || '').trim();
      const clinicInfo = getSelectedClinicInfo();
      const items = [
        ['__HEADER__', 'Klinik Bilgileri'],
        ['Il', citySel.value || '-'],
        ['Ilce', districtSel.value || '-'],
        ['Klinik', clinicInfo.name],
        ['Klinik Adresi', clinicInfo.address],
        ['Islem Tipi', proc.value || '-'],
        //['Tarih', selectedDate ? fmtDate(selectedDate) : '-'],
        ['Saat', selectedTime || '-'],
        ['__HEADER__', 'Hasta Bilgileri'],
        ['Ad Soyad', (fullname.value || '-')],
        //[nonCitizen.checked ? 'Pasaport No' : 'TCKN', idValue || '-'],
        //['Telefon', (phone.value || '-')],
        //['E-posta', (email.value || '-')]
      ];
      items.forEach(([k, v]) => {
        const li = document.createElement('li');
        if (k === '__HEADER__') {
          li.innerHTML = `<strong style="font-size:16px; color:${'var(--navy)'}; margin-top:8px; display:block;">${v}</strong>`;
        } else {
          li.innerHTML = `<div class="summary-key">${k}:</div><div>${v ? String(v) : '-'}</div>`;
        }
        summaryList.appendChild(li);
      });
      backdrop.style.display = 'flex';
    }
    function closeModal() { backdrop.style.display = 'none'; }

    document.getElementById('completeBtn').addEventListener('click', () => {
      if (!selectedDate || !selectedTime) return;
      openSummary();
    });
    closeSummary.addEventListener('click', closeModal);
    backdrop.addEventListener('click', (e) => { if (e.target === backdrop) closeModal(); });

    // init calendar when visible
    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) { buildCalendar(); obs.disconnect(); }
      });
    }, { threshold: 0.2 });
    obs.observe(calendarStep);
  </script>
</body>

</html>
